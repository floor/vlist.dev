<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            name="description"
            content="vlist documentation — API reference, configuration, events, methods, styling, and more."
        />
        <title>vlist — Docs</title>

        <style>
            *,
            *::before,
            *::after {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }

            :root {
                --text: #e8e8ed;
                --text-muted: #9a9aaa;
                --text-dim: #5a5a68;
                --bg: #0c0c10;
                --bg-sidebar: #101014;
                --bg-card: #141418;
                --bg-code: #18181e;
                --bg-code-inline: #1c1c24;
                --border: #1e1e25;
                --border-hover: #2e2e38;
                --accent: #667eea;
                --accent-dim: rgba(102, 126, 234, 0.15);
                --accent-text: #8da0f2;
                --sidebar-width: 260px;
                --header-height: 56px;
                --radius: 8px;
                --radius-sm: 5px;
            }

            html {
                scroll-behavior: smooth;
            }

            body {
                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
                    Roboto, Oxygen, Ubuntu, sans-serif;
                background: var(--bg);
                color: var(--text);
                min-height: 100vh;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                line-height: 1.6;
            }

            /* ─── Header ─────────────────────────────────────── */

            .header {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                height: var(--header-height);
                background: rgba(12, 12, 16, 0.85);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-bottom: 1px solid var(--border);
                display: flex;
                align-items: center;
                padding: 0 24px;
                z-index: 100;
                gap: 16px;
            }

            .header__logo {
                font-size: 18px;
                font-weight: 700;
                color: var(--text);
                text-decoration: none;
                letter-spacing: -0.3px;
            }

            .header__logo:hover {
                opacity: 0.85;
            }

            .header__sep {
                color: var(--text-dim);
                font-weight: 300;
                font-size: 20px;
                user-select: none;
            }

            .header__section {
                font-size: 14px;
                color: var(--text-muted);
                font-weight: 500;
            }

            .header__nav {
                margin-left: auto;
                display: flex;
                gap: 20px;
            }

            .header__nav a {
                font-size: 13px;
                color: var(--text-dim);
                text-decoration: none;
                transition: color 0.15s;
            }

            .header__nav a:hover {
                color: var(--text-muted);
            }

            .header__hamburger {
                display: none;
                background: none;
                border: none;
                color: var(--text-muted);
                cursor: pointer;
                padding: 4px;
                margin-left: auto;
            }

            /* ─── Layout ─────────────────────────────────────── */

            .layout {
                display: flex;
                padding-top: var(--header-height);
                min-height: 100vh;
            }

            /* ─── Sidebar ────────────────────────────────────── */

            .sidebar {
                position: fixed;
                top: var(--header-height);
                left: 0;
                bottom: 0;
                width: var(--sidebar-width);
                background: var(--bg-sidebar);
                border-right: 1px solid var(--border);
                overflow-y: auto;
                padding: 20px 0;
                z-index: 50;
            }

            .sidebar::-webkit-scrollbar {
                width: 4px;
            }

            .sidebar::-webkit-scrollbar-track {
                background: transparent;
            }

            .sidebar::-webkit-scrollbar-thumb {
                background: var(--border);
                border-radius: 2px;
            }

            .sidebar__group {
                margin-bottom: 20px;
            }

            .sidebar__label {
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.8px;
                color: var(--text-dim);
                padding: 0 20px;
                margin-bottom: 6px;
            }

            .sidebar__link {
                display: block;
                font-size: 13px;
                color: var(--text-muted);
                text-decoration: none;
                padding: 5px 20px;
                transition: all 0.1s;
                border-left: 2px solid transparent;
            }

            .sidebar__link:hover {
                color: var(--text);
                background: rgba(255, 255, 255, 0.03);
            }

            .sidebar__link--active {
                color: var(--accent-text);
                border-left-color: var(--accent);
                background: var(--accent-dim);
            }

            /* ─── Content ────────────────────────────────────── */

            .content {
                flex: 1;
                margin-left: var(--sidebar-width);
                max-width: 820px;
                padding: 40px 48px 80px;
            }

            /* ─── Index page ─────────────────────────────────── */

            .index {
                max-width: 680px;
            }

            .index__title {
                font-size: 32px;
                font-weight: 700;
                letter-spacing: -0.5px;
                margin-bottom: 8px;
            }

            .index__tagline {
                font-size: 16px;
                color: var(--text-muted);
                margin-bottom: 36px;
                line-height: 1.6;
            }

            .index__section {
                margin-bottom: 32px;
            }

            .index__section-title {
                font-size: 12px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.8px;
                color: var(--text-dim);
                margin-bottom: 12px;
            }

            .index__grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .index__card {
                display: block;
                background: var(--bg-card);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                padding: 16px 18px;
                text-decoration: none;
                color: inherit;
                transition: all 0.15s;
            }

            .index__card:hover {
                border-color: var(--border-hover);
                background: #161619;
            }

            .index__card-title {
                font-size: 14px;
                font-weight: 600;
                color: var(--text);
                margin-bottom: 3px;
            }

            .index__card-desc {
                font-size: 12px;
                color: var(--text-dim);
                line-height: 1.5;
            }

            /* ─── Markdown body ──────────────────────────────── */

            .md h1 {
                font-size: 30px;
                font-weight: 700;
                letter-spacing: -0.5px;
                margin-bottom: 8px;
                padding-bottom: 12px;
                border-bottom: 1px solid var(--border);
            }

            .md h2 {
                font-size: 22px;
                font-weight: 650;
                margin-top: 48px;
                margin-bottom: 16px;
                padding-bottom: 8px;
                border-bottom: 1px solid var(--border);
                letter-spacing: -0.3px;
            }

            .md h3 {
                font-size: 17px;
                font-weight: 600;
                margin-top: 32px;
                margin-bottom: 12px;
            }

            .md h4 {
                font-size: 14px;
                font-weight: 600;
                margin-top: 24px;
                margin-bottom: 8px;
                color: var(--text-muted);
            }

            .md h1:first-child {
                margin-top: 0;
            }

            .md h2:first-child {
                margin-top: 0;
            }

            /* Anchor links on headings */
            .md h1 .anchor,
            .md h2 .anchor,
            .md h3 .anchor,
            .md h4 .anchor {
                color: var(--text-dim);
                text-decoration: none;
                margin-left: 6px;
                opacity: 0;
                transition: opacity 0.15s;
                font-weight: 400;
            }

            .md h1:hover .anchor,
            .md h2:hover .anchor,
            .md h3:hover .anchor,
            .md h4:hover .anchor {
                opacity: 1;
            }

            .md p {
                margin-bottom: 16px;
                color: var(--text-muted);
                line-height: 1.7;
            }

            .md blockquote {
                border-left: 3px solid var(--accent);
                padding: 8px 16px;
                margin-bottom: 16px;
                background: var(--accent-dim);
                border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
            }

            .md blockquote p {
                color: var(--text-muted);
                margin-bottom: 0;
            }

            .md strong {
                font-weight: 600;
                color: var(--text);
            }

            .md a {
                color: var(--accent-text);
                text-decoration: none;
            }

            .md a:hover {
                text-decoration: underline;
            }

            .md ul,
            .md ol {
                margin-bottom: 16px;
                padding-left: 24px;
                color: var(--text-muted);
            }

            .md li {
                margin-bottom: 4px;
                line-height: 1.7;
            }

            .md li > ul,
            .md li > ol {
                margin-top: 4px;
                margin-bottom: 4px;
            }

            .md hr {
                border: none;
                border-top: 1px solid var(--border);
                margin: 32px 0;
            }

            /* ─── Code ───────────────────────────────────────── */

            .md code {
                font-family: "SF Mono", Monaco, Menlo, "Cascadia Code",
                    "Consolas", monospace;
                font-size: 0.88em;
                background: var(--bg-code-inline);
                padding: 2px 7px;
                border-radius: 4px;
                color: #c8cedc;
            }

            .md pre {
                background: var(--bg-code);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                padding: 16px 20px;
                margin-bottom: 16px;
                overflow-x: auto;
                line-height: 1.55;
            }

            .md pre::-webkit-scrollbar {
                height: 4px;
            }

            .md pre::-webkit-scrollbar-track {
                background: transparent;
            }

            .md pre::-webkit-scrollbar-thumb {
                background: var(--border);
                border-radius: 2px;
            }

            .md pre code {
                background: none;
                padding: 0;
                border-radius: 0;
                font-size: 13px;
                color: #c8cedc;
            }

            /* ─── Tables ─────────────────────────────────────── */

            .md table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 16px;
                font-size: 13px;
            }

            .md thead th {
                text-align: left;
                font-weight: 600;
                color: var(--text);
                padding: 8px 12px;
                border-bottom: 2px solid var(--border);
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .md tbody td {
                padding: 8px 12px;
                border-bottom: 1px solid var(--border);
                color: var(--text-muted);
                vertical-align: top;
            }

            .md tbody tr:last-child td {
                border-bottom: none;
            }

            .md tbody tr:hover {
                background: rgba(255, 255, 255, 0.02);
            }

            .md tbody td code {
                font-size: 12px;
            }

            /* ─── Syntax highlighting (manual dark theme) ──── */

            .hljs-keyword,
            .hljs-selector-tag,
            .hljs-built_in,
            .hljs-type {
                color: #c792ea;
            }

            .hljs-string,
            .hljs-attr {
                color: #c3e88d;
            }

            .hljs-number,
            .hljs-literal {
                color: #f78c6c;
            }

            .hljs-comment {
                color: #546e7a;
                font-style: italic;
            }

            .hljs-function .hljs-title,
            .hljs-title.function_ {
                color: #82aaff;
            }

            .hljs-variable,
            .hljs-template-variable {
                color: #eeffff;
            }

            .hljs-params {
                color: #c8cedc;
            }

            .hljs-property {
                color: #80cbc4;
            }

            .hljs-punctuation {
                color: #89ddff;
            }

            .hljs-meta {
                color: #ffcb6b;
            }

            .hljs-selector-class {
                color: #ffcb6b;
            }

            .hljs-selector-id {
                color: #82aaff;
            }

            .hljs-attribute {
                color: #c792ea;
            }

            .hljs-regexp {
                color: #89ddff;
            }

            .hljs-addition {
                color: #c3e88d;
            }

            .hljs-deletion {
                color: #ff5370;
            }

            /* ─── Loading / Error ────────────────────────────── */

            .loading {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 80px 0;
                color: var(--text-dim);
                font-size: 14px;
                gap: 10px;
            }

            .loading__spinner {
                width: 16px;
                height: 16px;
                border: 2px solid var(--border);
                border-top-color: var(--accent);
                border-radius: 50%;
                animation: spin 0.6s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .error {
                padding: 40px;
                text-align: center;
                color: var(--text-dim);
            }

            .error__title {
                font-size: 18px;
                font-weight: 600;
                color: var(--text-muted);
                margin-bottom: 8px;
            }

            .error__message {
                font-size: 14px;
                margin-bottom: 20px;
            }

            .error__link {
                color: var(--accent-text);
                text-decoration: none;
            }

            .error__link:hover {
                text-decoration: underline;
            }

            /* ─── Responsive ─────────────────────────────────── */

            @media (max-width: 900px) {
                :root {
                    --sidebar-width: 220px;
                }

                .content {
                    padding: 32px 32px 60px;
                }
            }

            @media (max-width: 720px) {
                .sidebar {
                    transform: translateX(-100%);
                    transition: transform 0.25s ease;
                    width: 280px;
                    background: var(--bg);
                    box-shadow: 4px 0 24px rgba(0, 0, 0, 0.4);
                }

                .sidebar--open {
                    transform: translateX(0);
                }

                .content {
                    margin-left: 0;
                    padding: 24px 20px 60px;
                }

                .header__hamburger {
                    display: block;
                }

                .header__nav {
                    display: none;
                }

                .index__grid {
                    grid-template-columns: 1fr;
                }

                .md pre {
                    padding: 12px 14px;
                }

                .overlay {
                    display: none;
                    position: fixed;
                    inset: 0;
                    background: rgba(0, 0, 0, 0.5);
                    z-index: 40;
                }

                .overlay--visible {
                    display: block;
                }
            }
        </style>
    </head>
    <body>
        <!-- Header -->
        <header class="header">
            <a href="/" class="header__logo">VList</a>
            <span class="header__sep">/</span>
            <span class="header__section">Docs</span>
            <nav class="header__nav">
                <a href="/sandbox/">Sandbox</a>
                <a href="/benchmarks/">Benchmarks</a>
                <a href="/api">API</a>
                <a href="https://github.com/floor/vlist" target="_blank">GitHub</a>
            </nav>
            <button class="header__hamburger" id="hamburger" aria-label="Toggle menu">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <rect y="3" width="20" height="2" rx="1" />
                    <rect y="9" width="20" height="2" rx="1" />
                    <rect y="15" width="20" height="2" rx="1" />
                </svg>
            </button>
        </header>

        <div class="overlay" id="overlay"></div>

        <div class="layout">
            <!-- Sidebar -->
            <nav class="sidebar" id="sidebar">
                <div class="sidebar__group">
                    <div class="sidebar__label">Getting Started</div>
                    <a href="/docs/" class="sidebar__link" data-doc="">Overview</a>
                    <a href="/docs/vlist" class="sidebar__link" data-doc="vlist">Documentation</a>
                    <a href="/docs/styles" class="sidebar__link" data-doc="styles">Styles</a>
                    <a href="/docs/optimization" class="sidebar__link" data-doc="optimization">Optimization</a>
                    <a href="/docs/benchmarks" class="sidebar__link" data-doc="benchmarks">Benchmarks</a>
                    <a href="/docs/known-issues" class="sidebar__link" data-doc="known-issues">Known Issues</a>
                </div>

                <div class="sidebar__group">
                    <div class="sidebar__label">Architecture</div>
                    <a href="/docs/types" class="sidebar__link" data-doc="types">Types</a>
                    <a href="/docs/constants" class="sidebar__link" data-doc="constants">Constants</a>
                    <a href="/docs/context" class="sidebar__link" data-doc="context">Context</a>
                </div>

                <div class="sidebar__group">
                    <div class="sidebar__label">Modules</div>
                    <a href="/docs/render" class="sidebar__link" data-doc="render">Render</a>
                    <a href="/docs/data" class="sidebar__link" data-doc="data">Data</a>
                    <a href="/docs/scroll" class="sidebar__link" data-doc="scroll">Scroll</a>
                    <a href="/docs/selection" class="sidebar__link" data-doc="selection">Selection</a>
                    <a href="/docs/events" class="sidebar__link" data-doc="events">Events</a>
                    <a href="/docs/compression" class="sidebar__link" data-doc="compression">Compression</a>
                </div>

                <div class="sidebar__group">
                    <div class="sidebar__label">API</div>
                    <a href="/docs/methods" class="sidebar__link" data-doc="methods">Methods</a>
                    <a href="/docs/handlers" class="sidebar__link" data-doc="handlers">Handlers</a>
                </div>

                <div class="sidebar__group">
                    <div class="sidebar__label">Resources</div>
                    <a href="/docs/sandbox" class="sidebar__link" data-doc="sandbox">Sandbox</a>
                    <a href="/docs/prompt-variable-heights" class="sidebar__link" data-doc="prompt-variable-heights">Variable Heights</a>
                </div>
            </nav>

            <!-- Content -->
            <main class="content" id="content">
                <div class="loading" id="loading">
                    <div class="loading__spinner"></div>
                    Loading…
                </div>
            </main>
        </div>

        <!-- Markdown parser + syntax highlighting -->
        <script src="https://cdn.jsdelivr.net/npm/marked@15/marked.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/languages/typescript.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/languages/bash.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/languages/css.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/languages/scss.min.js"></script>

        <script>
            // ─── Config ───────────────────────────────────────
            const INDEX_FILE = "README.md";
            const BASE_PATH = "/docs";

            const INDEX_CONTENT = `
                <div class="index">
                    <h1 class="index__title">Documentation</h1>
                    <p class="index__tagline">
                        API reference, configuration, events, methods, styling,
                        and internals for the vlist virtual list library.
                    </p>

                    <div class="index__section">
                        <div class="index__section-title">Getting Started</div>
                        <div class="index__grid">
                            <a href="/docs/vlist" class="index__card">
                                <div class="index__card-title">Documentation</div>
                                <div class="index__card-desc">Configuration, usage, events, selection, infinite scroll, and more</div>
                            </a>
                            <a href="/docs/styles" class="index__card">
                                <div class="index__card-title">Styles</div>
                                <div class="index__card-desc">CSS tokens, variants, dark mode, and customization</div>
                            </a>
                            <a href="/docs/optimization" class="index__card">
                                <div class="index__card-title">Optimization</div>
                                <div class="index__card-desc">Performance tuning and best practices</div>
                            </a>
                            <a href="/docs/compression" class="index__card">
                                <div class="index__card-title">Compression</div>
                                <div class="index__card-desc">Handling 1M+ items with scroll compression</div>
                            </a>
                            <a href="/docs/benchmarks" class="index__card">
                                <div class="index__card-title">Benchmarks</div>
                                <div class="index__card-desc">Live performance suites — FPS, render, memory</div>
                            </a>
                            <a href="/docs/known-issues" class="index__card">
                                <div class="index__card-title">Known Issues</div>
                                <div class="index__card-desc">Current limitations and workarounds</div>
                            </a>
                        </div>
                    </div>

                    <div class="index__section">
                        <div class="index__section-title">Architecture</div>
                        <div class="index__grid">
                            <a href="/docs/types" class="index__card">
                                <div class="index__card-title">Types</div>
                                <div class="index__card-desc">TypeScript interfaces and type definitions</div>
                            </a>
                            <a href="/docs/constants" class="index__card">
                                <div class="index__card-title">Constants</div>
                                <div class="index__card-desc">Default values and configuration constants</div>
                            </a>
                            <a href="/docs/context" class="index__card">
                                <div class="index__card-title">Context</div>
                                <div class="index__card-desc">Internal state container and coordination</div>
                            </a>
                        </div>
                    </div>

                    <div class="index__section">
                        <div class="index__section-title">Modules</div>
                        <div class="index__grid">
                            <a href="/docs/render" class="index__card">
                                <div class="index__card-title">Render</div>
                                <div class="index__card-desc">DOM rendering, virtualization, and element pooling</div>
                            </a>
                            <a href="/docs/data" class="index__card">
                                <div class="index__card-title">Data</div>
                                <div class="index__card-desc">Sparse storage, placeholders, and async adapters</div>
                            </a>
                            <a href="/docs/scroll" class="index__card">
                                <div class="index__card-title">Scroll</div>
                                <div class="index__card-desc">Scroll controller, custom scrollbar, and velocity</div>
                            </a>
                            <a href="/docs/selection" class="index__card">
                                <div class="index__card-title">Selection</div>
                                <div class="index__card-desc">Single &amp; multi-select state management</div>
                            </a>
                            <a href="/docs/events" class="index__card">
                                <div class="index__card-title">Events</div>
                                <div class="index__card-desc">Type-safe event emitter system</div>
                            </a>
                        </div>
                    </div>

                    <div class="index__section">
                        <div class="index__section-title">API</div>
                        <div class="index__grid">
                            <a href="/docs/methods" class="index__card">
                                <div class="index__card-title">Methods</div>
                                <div class="index__card-desc">Public API — data, scroll, selection, lifecycle</div>
                            </a>
                            <a href="/docs/handlers" class="index__card">
                                <div class="index__card-title">Handlers</div>
                                <div class="index__card-desc">Scroll, click, and keyboard event handlers</div>
                            </a>
                        </div>
                    </div>
                </div>
            `;

            // ─── State ────────────────────────────────────────

            const content = document.getElementById("content");
            const loading = document.getElementById("loading");
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("overlay");
            const hamburger = document.getElementById("hamburger");

            // ─── Marked setup ─────────────────────────────────

            const renderer = new marked.Renderer();

            // Add anchor links to headings
            renderer.heading = function ({ text, depth }) {
                // Extract raw text for slug (strip HTML tags)
                const raw = text.replace(/<[^>]*>/g, "");
                const slug = raw
                    .toLowerCase()
                    .replace(/[^\w\s-]/g, "")
                    .replace(/\s+/g, "-")
                    .replace(/-+/g, "-")
                    .trim();
                return `<h${depth} id="${slug}">${text} <a class="anchor" href="#${slug}">#</a></h${depth}>`;
            };

            // Rewrite .md links to clean URLs within docs
            renderer.link = function ({ href, title, text }) {
                if (href) {
                    // ./file.md → /docs/file
                    // ./file.md#section → /docs/file#section
                    const mdMatch = href.match(
                        /^\.\/([a-zA-Z0-9_-]+)\.md(#.*)?$/
                    );
                    if (mdMatch) {
                        href = `/docs/${mdMatch[1]}${mdMatch[2] || ""}`;
                    }
                    // #section → stays as-is (same page anchor)
                }
                const titleAttr = title ? ` title="${title}"` : "";
                const external =
                    href && href.startsWith("http")
                        ? ' target="_blank" rel="noopener"'
                        : "";
                return `<a href="${href}"${titleAttr}${external}>${text}</a>`;
            };

            marked.setOptions({
                renderer,
                gfm: true,
                breaks: false,
            });

            // ─── Routing ──────────────────────────────────────

            function getSlugFromPath(pathname) {
                // /docs/ → "" (index)
                // /docs/vlist → "vlist"
                // /docs/known-issues → "known-issues"
                let slug = pathname
                    .replace(/^\/docs\/?/, "")
                    .replace(/\.md$/, "")
                    .replace(/\/$/, "");
                return slug;
            }

            function getMdUrl(slug) {
                if (!slug) return `${BASE_PATH}/${INDEX_FILE}`;
                return `${BASE_PATH}/${slug}.md`;
            }

            // ─── Sidebar ──────────────────────────────────────

            function updateSidebar(slug) {
                sidebar.querySelectorAll(".sidebar__link").forEach((link) => {
                    const linkDoc = link.getAttribute("data-doc");
                    link.classList.toggle(
                        "sidebar__link--active",
                        linkDoc === slug
                    );
                });
            }

            // ─── Mobile menu ──────────────────────────────────

            function openSidebar() {
                sidebar.classList.add("sidebar--open");
                overlay.classList.add("overlay--visible");
            }

            function closeSidebar() {
                sidebar.classList.remove("sidebar--open");
                overlay.classList.remove("overlay--visible");
            }

            hamburger.addEventListener("click", () => {
                if (sidebar.classList.contains("sidebar--open")) {
                    closeSidebar();
                } else {
                    openSidebar();
                }
            });

            overlay.addEventListener("click", closeSidebar);

            // ─── Page loading ─────────────────────────────────

            async function loadPage(slug, pushState = true) {
                const isIndex = !slug;
                updateSidebar(slug);

                if (pushState) {
                    const url = isIndex ? "/docs/" : `/docs/${slug}`;
                    history.pushState({ slug }, "", url);
                }

                // Index page — render inline
                if (isIndex) {
                    content.innerHTML = INDEX_CONTENT;
                    document.title = "vlist — Docs";
                    window.scrollTo(0, 0);
                    return;
                }

                // Show loading
                content.innerHTML = `
                    <div class="loading">
                        <div class="loading__spinner"></div>
                        Loading…
                    </div>
                `;

                try {
                    const res = await fetch(getMdUrl(slug));
                    if (!res.ok) throw new Error(`${res.status}`);

                    const md = await res.text();
                    const html = marked.parse(md);

                    content.innerHTML = `<div class="md">${html}</div>`;

                    // Update page title from first h1
                    const h1 = content.querySelector("h1");
                    if (h1) {
                        const title = h1.textContent.replace(/#$/, "").trim();
                        document.title = `${title} — vlist docs`;
                    }

                    // Syntax highlighting
                    content.querySelectorAll("pre code").forEach((block) => {
                        hljs.highlightElement(block);
                    });

                    // Scroll to hash if present
                    if (window.location.hash) {
                        const target = document.querySelector(
                            window.location.hash
                        );
                        if (target) {
                            target.scrollIntoView({ behavior: "instant" });
                            return;
                        }
                    }

                    window.scrollTo(0, 0);
                } catch (err) {
                    content.innerHTML = `
                        <div class="error">
                            <div class="error__title">Page not found</div>
                            <div class="error__message">Could not load "${slug}.md"</div>
                            <a href="/docs/" class="error__link">← Back to docs</a>
                        </div>
                    `;
                }

                closeSidebar();
            }

            // ─── Navigation interception ──────────────────────

            document.addEventListener("click", (e) => {
                const link = e.target.closest("a");
                if (!link) return;

                const href = link.getAttribute("href");
                if (!href) return;

                // Only intercept internal /docs/ links
                if (href.startsWith("/docs")) {
                    e.preventDefault();

                    // Parse hash from href
                    const [path, hash] = href.split("#");
                    const slug = getSlugFromPath(path);

                    const currentSlug = getSlugFromPath(
                        window.location.pathname
                    );

                    if (slug === currentSlug && hash) {
                        // Same page, just scroll to anchor
                        const target = document.getElementById(hash);
                        if (target) {
                            history.pushState(null, "", `#${hash}`);
                            target.scrollIntoView({ behavior: "smooth" });
                        }
                        return;
                    }

                    loadPage(slug).then(() => {
                        if (hash) {
                            requestAnimationFrame(() => {
                                const target = document.getElementById(hash);
                                if (target) {
                                    history.replaceState(
                                        null,
                                        "",
                                        `/docs/${slug}#${hash}`
                                    );
                                    target.scrollIntoView({
                                        behavior: "instant",
                                    });
                                }
                            });
                        }
                    });
                }
            });

            // ─── Browser back/forward ─────────────────────────

            window.addEventListener("popstate", () => {
                const slug = getSlugFromPath(window.location.pathname);
                loadPage(slug, false);
            });

            // ─── Initial load ─────────────────────────────────

            const initialSlug = getSlugFromPath(window.location.pathname);
            loadPage(initialSlug, false);
        </script>
    </body>
</html>
