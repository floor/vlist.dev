# VList v0.9.0 Migration Guide

**Version**: 0.8.2 ‚Üí 0.9.0  
**Date**: January 2025  
**Type**: Major Breaking Changes  
**Impact**: API Rename - Dimension-Agnostic Refactoring

---

## Overview

Version 0.9.0 introduces two major breaking changes for semantic clarity and correctness:

1. **Dimension-Agnostic API**: `HeightCache` ‚Üí `SizeCache`, `scrollTop` ‚Üí `scrollPosition`, etc.
2. **Orientation Rename**: `direction` ‚Üí `orientation`

Both changes improve semantic correctness, especially for horizontal scrolling mode.

---

## Breaking Changes

### 1. Config Property: `direction` ‚Üí `orientation`

**Rationale**: "Orientation" better describes layout arrangement than "direction" (which implies motion).

#### Before (v0.8.2)

```typescript
const list = vlist({
  container: '#list',
  direction: 'horizontal',
  item: { width: 200, template: render }
}).build();
```

#### After (v0.9.0)

```typescript
const list = vlist({
  container: '#list',
  orientation: 'horizontal',  // ‚ú® Renamed
  item: { width: 200, template: render }
}).build();
```

**Migration**:
```bash
# Update all config objects
sed -i "s/direction: 'horizontal'/orientation: 'horizontal'/g" **/*.ts
sed -i "s/direction: 'vertical'/orientation: 'vertical'/g" **/*.ts
```

---

### 2. Core Types: Height ‚Üí Size

**Rationale**: Generic "size" terminology works for both height (vertical) and width (horizontal).

#### HeightCache ‚Üí SizeCache

**Before (v0.8.2)**:
```typescript
import { createHeightCache, HeightCache } from 'vlist';

const cache: HeightCache = createHeightCache(50, 1000);
const itemHeight = cache.getHeight(index);
const totalHeight = cache.getTotalHeight();
```

**After (v0.9.0)**:
```typescript
import { createSizeCache, SizeCache } from 'vlist';

const cache: SizeCache = createSizeCache(50, 1000);
const itemSize = cache.getSize(index);
const totalSize = cache.getTotalSize();
```

**Migration**:
```bash
sed -i 's/HeightCache/SizeCache/g' **/*.ts
sed -i 's/createHeightCache/createSizeCache/g' **/*.ts
sed -i 's/\.getHeight(/.getSize(/g' **/*.ts
sed -i 's/\.getTotalHeight(/.getTotalSize(/g' **/*.ts
```

---

### 3. ViewportState Properties

**Before (v0.8.2)**:
```typescript
interface ViewportState {
  scrollTop: number;        // Current scroll position
  containerHeight: number;  // Viewport size
  totalHeight: number;      // Content size (may be capped)
  actualHeight: number;     // True content size
  // ...
}
```

**After (v0.9.0)**:
```typescript
interface ViewportState {
  scrollPosition: number;   // Current scroll position
  containerSize: number;    // Viewport size
  totalSize: number;        // Content size (may be capped)
  actualSize: number;       // True content size
  // ...
}
```

**Migration**:
```bash
sed -i 's/\.scrollTop/.scrollPosition/g' **/*.ts
sed -i 's/\.containerHeight/.containerSize/g' **/*.ts
sed -i 's/\.totalHeight/.totalSize/g' **/*.ts
sed -i 's/\.actualHeight/.actualSize/g' **/*.ts
```

---

### 4. Event Payloads

**Before (v0.8.2)**:
```typescript
list.on('scroll', ({ scrollTop, direction }) => {
  console.log(`Scrolled to ${scrollTop}px`);
});
```

**After (v0.9.0)**:
```typescript
list.on('scroll', ({ scrollPosition, direction }) => {
  console.log(`Scrolled to ${scrollPosition}px`);
});
```

**Migration**:
```bash
sed -i 's/{ scrollTop,/{ scrollPosition,/g' **/*.ts
sed -i 's/({ scrollTop/({ scrollPosition/g' **/*.ts
```

---

### 5. Compression/Scale Feature

**Before (v0.8.2)**:
```typescript
interface CompressionState {
  actualHeight: number;
  virtualHeight: number;
  compressionRatio: number;
}
```

**After (v0.9.0)**:
```typescript
interface CompressionState {
  actualSize: number;
  virtualSize: number;
  compressionRatio: number;
}
```

**Migration**:
```bash
sed -i 's/\.actualHeight/.actualSize/g' **/*.ts
sed -i 's/\.virtualHeight/.virtualSize/g' **/*.ts
```

---

### 6. Utility Functions

**Before (v0.8.2)**:
```typescript
import { 
  calculateTotalHeight,
  calculateActualHeight,
  createGroupedHeightFn,
  createSectionedHeightFn
} from 'vlist';
```

**After (v0.9.0)**:
```typescript
import { 
  calculateTotalSize,
  calculateActualSize,
  createGroupedSizeFn,
  createSectionedSizeFn
} from 'vlist';
```

**Migration**:
```bash
sed -i 's/calculateTotalHeight/calculateTotalSize/g' **/*.ts
sed -i 's/calculateActualHeight/calculateActualSize/g' **/*.ts
sed -i 's/createGroupedHeightFn/createGroupedSizeFn/g' **/*.ts
sed -i 's/createSectionedHeightFn/createSectionedSizeFn/g' **/*.ts
```

---

### 7. BuilderContext Methods

**Before (v0.8.2)**:
```typescript
ctx.rebuildHeightCache(total);
ctx.setHeightConfig(newConfig);
```

**After (v0.9.0)**:
```typescript
ctx.rebuildSizeCache(total);
ctx.setSizeConfig(newConfig);
```

**Migration**:
```bash
sed -i 's/rebuildHeightCache/rebuildSizeCache/g' **/*.ts
sed -i 's/setHeightConfig/setSizeConfig/g' **/*.ts
```

---

## Complete Migration Script

Save this as `migrate-to-v0.9.0.sh` and run it in your project:

```bash
#!/bin/bash

# v0.9.0 Migration Script for VList

echo "üîÑ Migrating to VList v0.9.0..."

# 1. Orientation rename
echo "  ‚Üí Updating 'direction' to 'orientation'..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak "s/direction: 'horizontal'/orientation: 'horizontal'/g" {} \; \
  -exec sed -i.bak "s/direction: 'vertical'/orientation: 'vertical'/g" {} \; \
  -exec sed -i.bak 's/direction: "horizontal"/orientation: "horizontal"/g' {} \; \
  -exec sed -i.bak 's/direction: "vertical"/orientation: "vertical"/g' {} \;

# 2. HeightCache ‚Üí SizeCache
echo "  ‚Üí Updating HeightCache to SizeCache..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak 's/HeightCache/SizeCache/g' {} \; \
  -exec sed -i.bak 's/createHeightCache/createSizeCache/g' {} \; \
  -exec sed -i.bak 's/\.getHeight(/.getSize(/g' {} \; \
  -exec sed -i.bak 's/\.getTotalHeight(/.getTotalSize(/g' {} \;

# 3. ViewportState properties
echo "  ‚Üí Updating ViewportState properties..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak 's/\.scrollTop/.scrollPosition/g' {} \; \
  -exec sed -i.bak 's/\.containerHeight/.containerSize/g' {} \; \
  -exec sed -i.bak 's/\.totalHeight/.totalSize/g' {} \; \
  -exec sed -i.bak 's/\.actualHeight/.actualSize/g' {} \; \
  -exec sed -i.bak 's/\.virtualHeight/.virtualSize/g' {} \;

# 4. Event payloads
echo "  ‚Üí Updating event payloads..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak 's/{ scrollTop,/{ scrollPosition,/g' {} \; \
  -exec sed -i.bak 's/({ scrollTop/({ scrollPosition/g' {} \;

# 5. Utility functions
echo "  ‚Üí Updating utility functions..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak 's/calculateTotalHeight/calculateTotalSize/g' {} \; \
  -exec sed -i.bak 's/calculateActualHeight/calculateActualSize/g' {} \; \
  -exec sed -i.bak 's/createGroupedHeightFn/createGroupedSizeFn/g' {} \; \
  -exec sed -i.bak 's/createSectionedHeightFn/createSectionedSizeFn/g' {} \;

# 6. BuilderContext methods
echo "  ‚Üí Updating BuilderContext methods..."
find . -type f \( -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" \) \
  -exec sed -i.bak 's/rebuildHeightCache/rebuildSizeCache/g' {} \; \
  -exec sed -i.bak 's/setHeightConfig/setSizeConfig/g' {} \;

# Clean up backup files
echo "  ‚Üí Cleaning up backup files..."
find . -name "*.bak" -delete

echo "‚úÖ Migration complete!"
echo ""
echo "‚ö†Ô∏è  Important: Review the changes and test your application."
echo "    Some edge cases may require manual updates."
```

---

## What Stays The Same

### ‚úÖ No Changes to These

- **DOM properties**: `element.scrollTop`, `element.clientHeight` (native DOM)
- **CSS properties**: `height`, `width` in stylesheets
- **User config**: `item.height`, `item.width` (user-facing config names)
- **Grid context**: When "height" refers to actual HEIGHT dimension (cross-axis)
- **Public methods**: `scrollToIndex()`, `setItems()`, etc. (unchanged)
- **Events**: `'scroll'`, `'range:change'`, etc. (event names unchanged)
- **Feature names**: `withGrid()`, `withSections()`, etc. (unchanged)

---

## New Features in v0.9.0

### 1. Horizontal Sections Support

Sections feature now works with horizontal orientation:

```typescript
const carousel = vlist({
  container: '#carousel',
  orientation: 'horizontal',  // ‚ú® Now supported!
  item: { width: 200, template: renderProduct }
})
.use(withSections({
  getGroupForIndex: (i) => products[i].category,
  headerHeight: 60,  // Width in horizontal mode
  headerTemplate: (category) => `<h3>${category}</h3>`,
  sticky: true  // Sticks to left edge in horizontal mode
}))
.build();
```

---

## TypeScript Support

All types are updated. Your IDE should show errors for old property names:

```typescript
// ‚ùå TypeScript will error
const state: ViewportState = {
  scrollTop: 0,           // ‚ùå Error: Property 'scrollTop' does not exist
  containerHeight: 600    // ‚ùå Error: Property 'containerHeight' does not exist
};

// ‚úÖ Correct
const state: ViewportState = {
  scrollPosition: 0,      // ‚úÖ Correct
  containerSize: 600      // ‚úÖ Correct
};
```

---

## Manual Review Checklist

After running the migration script, manually review:

- [ ] **Custom features** - Update any feature code that uses old API
- [ ] **Type definitions** - Ensure custom types use new property names
- [ ] **Comments** - Update comments that mention old terminology
- [ ] **Tests** - Update test assertions and mock data
- [ ] **Documentation** - Update any internal docs or README files
- [ ] **Variable names** - Consider renaming variables for clarity

---

## Testing Your Migration

1. **Type check**: Run TypeScript compiler to catch any missed renames
   ```bash
   tsc --noEmit
   ```

2. **Run tests**: Ensure all tests pass
   ```bash
   npm test
   ```

3. **Manual testing**: Test key features in your app:
   - Scrolling (vertical and horizontal)
   - Dynamic data updates
   - Feature functionality
   - Event handlers

4. **Browser testing**: Test in your target browsers

---

## Troubleshooting

### Issue: "Property 'scrollTop' does not exist"

**Solution**: You missed a ViewportState property rename.
```typescript
// Fix:
- state.scrollTop
+ state.scrollPosition
```

### Issue: "Cannot find name 'HeightCache'"

**Solution**: Import was not updated.
```typescript
// Fix:
- import { HeightCache } from 'vlist';
+ import { SizeCache } from 'vlist';
```

### Issue: "Property 'direction' does not exist"

**Solution**: Config property not renamed.
```typescript
// Fix:
- direction: 'horizontal'
+ orientation: 'horizontal'
```

### Issue: Grid feature error in horizontal mode

**Solution**: Grid feature doesn't support horizontal orientation (by design).
```typescript
// This combination is not allowed:
vlist({
  orientation: 'horizontal',  // ‚ùå
}).use(withGrid())            // ‚ùå

// Use sections instead:
vlist({
  orientation: 'horizontal',  // ‚úÖ
}).use(withSections())        // ‚úÖ
```

---

## Support

- **Documentation**: [vlist.dev/docs](https://vlist.dev/docs)
- **Examples**: [vlist.dev/examples](https://vlist.dev/examples)
- **Issues**: [github.com/floor/vlist/issues](https://github.com/floor/vlist/issues)

---

## Why These Changes?

### Semantic Correctness

**Before (v0.8.2)**: In horizontal mode, code was semantically wrong:
```typescript
heightCache.getHeight(index)  // Returns WIDTH üòµ
state.scrollTop               // Stores scrollLEFT ü§Ø
state.containerHeight         // Stores WIDTH üíÄ
```

**After (v0.9.0)**: Semantically correct in all modes:
```typescript
sizeCache.getSize(index)      // Returns size (height OR width) ‚úÖ
state.scrollPosition          // Scroll position (top OR left) ‚úÖ
state.containerSize           // Container size (any dimension) ‚úÖ
```

### Industry Alignment

The `orientation` rename aligns with common UI library conventions:
- Material UI: `orientation="horizontal"`
- Native APIs: Portrait/landscape orientation
- Natural phrasing: "The list orientation is horizontal"

---

**Last Updated**: January 2025  
**VList Version**: 0.9.0  
**Status**: ‚úÖ Complete
